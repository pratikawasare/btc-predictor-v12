<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC Predictor v15 ULTIMATE</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #0f172a; min-height: 100vh; padding: 20px; color: #e2e8f0; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .logo { font-size: 56px; margin-bottom: 15px; background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 20px rgba(245, 158, 11, 0.3)); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        h1 { font-size: 48px; font-weight: 800; background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; letter-spacing: -2px; }
        .version { color: #94a3b8; font-size: 14px; font-weight: 500; }
        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(20px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 20px; padding: 25px; transition: all 0.3s ease; }
        .card:hover { border-color: rgba(245, 158, 11, 0.3); transform: translateY(-2px); }
        .trading-panel { background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 20px; padding: 25px; margin-bottom: 20px; }
        .trading-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        .input-label { font-size: 11px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .input-field { width: 100%; padding: 12px; background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 10px; color: #e2e8f0; font-size: 16px; font-weight: 600; transition: all 0.3s ease; }
        .input-field:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        .leverage-selector { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .leverage-btn { padding: 8px; background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(148, 163, 184, 0.2); border-radius: 8px; color: #94a3b8; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; }
        .leverage-btn:hover { border-color: #10b981; color: #10b981; }
        .leverage-btn.active { background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-color: #10b981; color: white; }
        .trade-btn { padding: 16px; border: none; border-radius: 12px; font-weight: 800; font-size: 16px; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; width: 100%; margin-top: 15px; }
        .trade-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .trade-btn.start { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .trade-btn.stop { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .trading-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 20px; }
        .stat-box { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 12px; padding: 15px; text-align: center; }
        .stat-label { font-size: 10px; color: #64748b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 24px; font-weight: 800; }
        .stat-positive { color: #10b981; }
        .stat-negative { color: #ef4444; }
        .stat-neutral { color: #f59e0b; }
        .liquidation-warning { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 15px; margin-top: 15px; text-align: center; }
        .liquidation-warning.active { animation: pulse-warning 2s infinite; }
        @keyframes pulse-warning { 0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.3); } 50% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.6); } }
        .price-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .price-card { background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(249, 115, 22, 0.1) 100%); border: 1px solid rgba(245, 158, 11, 0.2); border-radius: 16px; padding: 25px; text-align: center; position: relative; overflow: hidden; }
        .price-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #f59e0b 0%, #f97316 100%); }
        .price-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #94a3b8; font-weight: 600; margin-bottom: 12px; }
        .price-value { font-size: 36px; font-weight: 800; color: #f59e0b; margin-bottom: 8px; }
        .price-change { font-size: 13px; font-weight: 600; margin-top: 8px; }
        .price-change.positive { color: #10b981; }
        .price-change.negative { color: #ef4444; }
        .confidence-bar { margin-top: 12px; height: 6px; background: rgba(30, 41, 59, 0.3); border-radius: 10px; overflow: hidden; }
        .confidence-fill { height: 100%; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%); transition: width 0.5s ease; }
        .confidence-text { font-size: 11px; color: #64748b; margin-top: 6px; }
        .streak-badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; margin-top: 10px; animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px rgba(245, 158, 11, 0.3); } 50% { box-shadow: 0 0 20px rgba(245, 158, 11, 0.6); } }
        .streak-win { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .streak-loss { background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); }
        .pulse { width: 8px; height: 8px; background: #10b981; border-radius: 50%; display: inline-block; margin-left: 8px; animation: pulse 2s infinite; box-shadow: 0 0 10px #10b981; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        .chart-card { height: 400px; }
        .chart-container { position: relative; height: calc(100% - 45px); }
        .section-title { font-size: 14px; font-weight: 700; color: #e2e8f0; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .stat-item { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 12px; padding: 18px; text-align: center; transition: all 0.3s ease; }
        .stat-item:hover { border-color: rgba(245, 158, 11, 0.3); transform: scale(1.05); }
        .weights-section, .log-section { max-height: 250px; overflow-y: auto; }
        .weights-section::-webkit-scrollbar, .log-section::-webkit-scrollbar { width: 4px; }
        .weights-section::-webkit-scrollbar-track, .log-section::-webkit-scrollbar-track { background: rgba(30, 41, 59, 0.3); border-radius: 10px; }
        .weights-section::-webkit-scrollbar-thumb, .log-section::-webkit-scrollbar-thumb { background: rgba(245, 158, 11, 0.3); border-radius: 10px; }
        .weight-bar { margin-bottom: 12px; }
        .weight-label { font-size: 11px; color: #94a3b8; margin-bottom: 6px; display: flex; justify-content: space-between; font-weight: 600; }
        .weight-progress { height: 8px; background: rgba(30, 41, 59, 0.3); border-radius: 10px; overflow: hidden; }
        .weight-fill { height: 100%; background: linear-gradient(90deg, #f59e0b 0%, #f97316 100%); transition: width 0.5s ease; box-shadow: 0 0 10px rgba(245, 158, 11, 0.5); }
        .log-entry { font-size: 12px; padding: 10px 0; border-bottom: 1px solid rgba(148, 163, 184, 0.1); color: #94a3b8; font-weight: 500; }
        .log-entry:last-child { border-bottom: none; }
        .log-entry.correct { color: #10b981; }
        .log-entry.incorrect { color: #ef4444; }
        .trade-log { max-height: 300px; overflow-y: auto; }
        .trade-entry { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 10px; padding: 12px; margin-bottom: 10px; font-size: 12px; }
        .trade-entry.profit { border-left: 3px solid #10b981; }
        .trade-entry.loss { border-left: 3px solid #ef4444; }
        .trade-entry.liquidated { border-left: 3px solid #dc2626; background: rgba(239, 68, 68, 0.05); }
        .controls { display: flex; gap: 12px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-weight: 700; font-size: 13px; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn:hover { transform: translateY(-2px); }
        .btn-export { background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; }
        .btn-import { background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); color: white; }
        .btn-reset { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; }
        .btn-sound { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; }
        .badge { display: inline-block; padding: 6px 14px; border-radius: 20px; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; }
        .loading { text-align: center; padding: 100px 20px; }
        .spinner { border: 4px solid rgba(245, 158, 11, 0.1); border-top: 4px solid #f59e0b; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 1200px) { .main-grid { grid-template-columns: 1fr; } .trading-stats { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">₿</div>
            <h1>BTC Predictor v15 ULTIMATE</h1>
            <div class="version">Paper Trading • Live P&L • Leverage • 11 Indicators</div>
        </div>
        <div id="loading" class="loading"><div class="spinner"></div><p style="color: #64748b;">Connecting to Pyth Network...</p></div>
        <div id="content" style="display: none;">
            <div class="trading-panel">
                <div class="section-title">💰 Paper Trading Control Panel</div>
                <div class="trading-controls">
                    <div class="input-group"><div class="input-label">Starting Balance ($)</div><input type="number" id="tradeAmount" class="input-field" value="1000" min="10" step="10"></div>
                    <div class="input-group"><div class="input-label">Leverage</div><div class="leverage-selector">
                        <button class="leverage-btn active" data-lev="1">1x</button><button class="leverage-btn" data-lev="2">2x</button><button class="leverage-btn" data-lev="5">5x</button><button class="leverage-btn" data-lev="10">10x</button><button class="leverage-btn" data-lev="20">20x</button><button class="leverage-btn" data-lev="50">50x</button><button class="leverage-btn" data-lev="75">75x</button><button class="leverage-btn" data-lev="100">100x</button>
                    </div></div>
                </div>
                <button id="startTrading" class="trade-btn start">🚀 Start Trading</button>
                <button id="stopTrading" class="trade-btn stop" style="display: none;">⏹️ Stop Trading</button>
                <div class="trading-stats">
                    <div class="stat-box"><div class="stat-label">Current Balance</div><div class="stat-value stat-neutral" id="currentBalance">$1000.00</div></div>
                    <div class="stat-box"><div class="stat-label">Live P&L</div><div class="stat-value stat-neutral" id="livePnL">$0.00</div><div style="font-size: 11px; color: #64748b; margin-top: 4px;" id="livePnLPercent">0.00%</div></div>
                    <div class="stat-box"><div class="stat-label">Win Trades</div><div class="stat-value stat-positive" id="winCount">0</div></div>
                    <div class="stat-box"><div class="stat-label">Liquidations</div><div class="stat-value stat-negative" id="liqCount">0</div></div>
                </div>
                <div id="liquidationWarning" class="liquidation-warning" style="display: none;"><div style="font-size: 14px; font-weight: 700; color: #ef4444; margin-bottom: 5px;">⚠️ LIQUIDATION WARNING</div><div style="font-size: 12px; color: #fca5a5;">Price: <span id="liqPrice">--</span> | Distance: <span id="liqDistance">--</span>%</div></div>
            </div>
            <div class="main-grid">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="price-section">
                        <div class="price-card"><div class="price-label">Current Price<span class="pulse"></span></div><div class="price-value" id="currentPrice">$--</div><div class="price-change" id="priceChange">--</div><div style="font-size: 11px; color: #64748b; margin-top: 8px;" id="lastUpdate">--</div><div class="badge" style="background: rgba(245,158,11,0.2); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3);">⚡ PYTH</div></div>
                        <div class="price-card"><div class="price-label">5-Min Prediction</div><div class="price-value" id="predictedPrice">$--</div><div style="font-size: 18px; font-weight: 700; margin-top: 10px;" id="direction">--</div><div class="confidence-bar"><div class="confidence-fill" id="confidenceFill" style="width: 0%"></div></div><div class="confidence-text" id="confidenceText">Confidence: --</div><span id="regime" class="badge" style="background: rgba(245,158,11,0.2); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3);">RANGING</span><div id="streakBadge"></div><div style="font-size: 11px; color: #64748b; margin-top: 8px;" id="predictionTime">--</div></div>
                    </div>
                    <div class="card chart-card"><div class="section-title">📈 Prediction vs Actual Chart</div><div class="chart-container"><canvas id="predictionChart"></canvas></div></div>
                </div>
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="card"><div class="section-title">📊 Statistics</div><div class="stats-grid">
                        <div class="stat-item"><div class="stat-label">Accuracy</div><div class="stat-value" id="accuracy">--%</div></div>
                        <div class="stat-item"><div class="stat-label">Predictions</div><div class="stat-value" id="totalPredictions">0</div></div>
                        <div class="stat-item"><div class="stat-label">Data Points</div><div class="stat-value" id="dataPoints">0</div></div>
                        <div class="stat-item"><div class="stat-label">Win Rate</div><div class="stat-value" id="winRate">--%</div></div>
                    </div></div>
                    <div class="card"><div class="section-title">🧠 Model Weights (11 Indicators)</div><div class="weights-section" id="weightsDisplay"></div></div>
                    <div class="card"><div class="section-title">📊 Trade Log</div><div class="trade-log" id="tradeLog"><div style="text-align: center; color: #64748b; padding: 20px;">No trades yet.</div></div></div>
                    <div class="card"><div class="section-title">📋 Recent Predictions</div><div class="log-section" id="logEntries"><div class="log-entry" style="text-align: center;">Waiting...</div></div></div>
                </div>
            </div>
            <div class="controls">
                <button id="exportBtn" class="btn btn-export">📥 Export</button>
                <button id="importBtn" class="btn btn-import">📤 Import</button>
                <button id="soundBtn" class="btn btn-sound">🔔 Sound: OFF</button>
                <button id="resetBtn" class="btn btn-reset">🔄 Reset</button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;">
        </div>
    </div>
    <script>
        const PYTH_BTC_ID='0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43';const PYTH_API_URL='https://hermes.pyth.network/api/latest_price_feeds';const UPDATE_INTERVAL=10000;const PREDICTION_WINDOW=5;const MIN_DATA_POINTS=25;const STABILITY_FACTOR=0.4;const LEARNING_RATE=0.03;let history=[],predictions=[],evaluatedPredictions=[],chartData={labels:[],actual:[],predicted:[]},modelWeights={trend:9,momentum:9,rsi:9,macd:9,ema:9,volatility:9,volume:9,stochastic:9,bb:9,adx:9,atr:9},chart=null,startTime=Date.now(),soundEnabled=false,currentStreak={type:null,count:0},lastPriceForChange=0,firstPrice=0;let isTrading=false,startingBalance=1000,currentBalance=1000,leverage=1,position=null,winCount=0,liqCount=0,trades=[];document.querySelectorAll('.leverage-btn').forEach(btn=>{btn.addEventListener('click',()=>{document.querySelectorAll('.leverage-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');leverage=parseInt(btn.dataset.lev);if(position)updateLiquidationWarning();});});document.getElementById('startTrading').addEventListener('click',startTrading);document.getElementById('stopTrading').addEventListener('click',stopTrading);document.getElementById('soundBtn').addEventListener('click',()=>{soundEnabled=!soundEnabled;document.getElementById('soundBtn').innerHTML=soundEnabled?'🔔 Sound: ON':'🔔 Sound: OFF';if(soundEnabled)playSound();});function playSound(){const audio=new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZXQ==');audio.volume=0.3;audio.play().catch(e=>{});}function startTrading(){startingBalance=parseFloat(document.getElementById('tradeAmount').value)||1000;currentBalance=startingBalance;isTrading=true;winCount=0;liqCount=0;trades=[];document.getElementById('startTrading').style.display='none';document.getElementById('stopTrading').style.display='block';document.getElementById('tradeAmount').disabled=true;updateTradingUI();}function stopTrading(){if(position)closePosition('Manual Stop');isTrading=false;document.getElementById('startTrading').style.display='block';document.getElementById('stopTrading').style.display='none';document.getElementById('tradeAmount').disabled=false;document.getElementById('liquidationWarning').style.display='none';}function calculateLiquidationPrice(entry,type,lev){if(lev===1)return type==='long'?0:999999999;const liqPercent=(1/lev)*0.9;return type==='long'?entry*(1-liqPercent):entry*(1+liqPercent);}function updateLiquidationWarning(){if(!position){document.getElementById('liquidationWarning').style.display='none';return;}const liqPrice=calculateLiquidationPrice(position.entry,position.type,position.leverage);const currentPrice=history[history.length-1];const distance=((liqPrice-currentPrice)/currentPrice)*100;document.getElementById('liqPrice').textContent='$'+liqPrice.toLocaleString('en-US',{minimumFractionDigits:2});document.getElementById('liqDistance').textContent=distance.toFixed(2);if(Math.abs(distance)<5){document.getElementById('liquidationWarning').style.display='block';document.getElementById('liquidationWarning').classList.add('active');}else if(Math.abs(distance)<10){document.getElementById('liquidationWarning').style.display='block';document.getElementById('liquidationWarning').classList.remove('active');}else{document.getElementById('liquidationWarning').style.display='none';}}function openPosition(type,entry){if(currentBalance<=0)return;const tradeAmount=currentBalance*0.95;position={type,entry,amount:tradeAmount,leverage,time:new Date()};updateLiquidationWarning();}function closePosition(reason,currentPrice=null){if(!position)return;currentPrice=currentPrice||history[history.length-1];const priceChange=((currentPrice-position.entry)/position.entry);const multiplier=position.type==='long'?1:-1;const pnlPercent=priceChange*multiplier*position.leverage;const pnl=position.amount*pnlPercent;currentBalance+=pnl;const trade={type:position.type,entry:position.entry,exit:currentPrice,leverage:position.leverage,pnl,pnlPercent:pnlPercent*100,reason,time:position.time,closeTime:new Date()};if(reason==='Liquidated'){currentBalance=0;liqCount++;trade.liquidated=true;}else if(pnl>0){winCount++;}trades.unshift(trade);if(trades.length>20)trades.pop();position=null;updateTradingUI();updateTradeLog();}function checkLiquidation(currentPrice){if(!position)return;const liqPrice=calculateLiquidationPrice(position.entry,position.type,position.leverage);if(position.type==='long'&&currentPrice<=liqPrice){closePosition('Liquidated',liqPrice);}else if(position.type==='short'&&currentPrice>=liqPrice){closePosition('Liquidated',liqPrice);}}function updateTradingUI(){document.getElementById('currentBalance').textContent='$'+currentBalance.toFixed(2);document.getElementById('currentBalance').className='stat-value '+(currentBalance>startingBalance?'stat-positive':currentBalance<startingBalance?'stat-negative':'stat-neutral');document.getElementById('winCount').textContent=winCount;document.getElementById('liqCount').textContent=liqCount;if(position&&history.length>0){const currentPrice=history[history.length-1];const priceChange=((currentPrice-position.entry)/position.entry);const multiplier=position.type==='long'?1:-1;const pnlPercent=priceChange*multiplier*position.leverage;const livePnL=position.amount*pnlPercent;document.getElementById('livePnL').textContent=(livePnL>=0?'+':'')+'$'+livePnL.toFixed(2);document.getElementById('livePnL').className='stat-value '+(livePnL>=0?'stat-positive':'stat-negative');document.getElementById('livePnLPercent').textContent=(pnlPercent*100>=0?'+':'')+(pnlPercent*100).toFixed(2)+'%';}else{document.getElementById('livePnL').textContent='$0.00';document.getElementById('livePnL').className='stat-value stat-neutral';document.getElementById('livePnLPercent').textContent='0.00%';}updateLiquidationWarning();}function updateTradeLog(){if(trades.length===0)return;const html=trades.map(t=>{const pnlClass=t.liquidated?'liquidated':(t.pnl>0?'profit':'loss');const emoji=t.liquidated?'💀':(t.pnl>0?'✅':'❌');return`<div class="trade-entry ${pnlClass}"><div style="display:flex;justify-content:space-between;margin-bottom:5px;"><span style="font-weight:700;">${emoji} ${t.type.toUpperCase()} ${t.leverage}x</span><span style="font-weight:700;color:${t.pnl>=0?'#10b981':'#ef4444'};">${t.pnl>=0?'+':''}$${t.pnl.toFixed(2)}</span></div><div style="font-size:11px;color:#64748b;">Entry: $${t.entry.toFixed(2)} → Exit: $${t.exit.toFixed(2)} (${t.pnlPercent>=0?'+':''}${t.pnlPercent.toFixed(2)}%)</div><div style="font-size:10px;color:#475569;margin-top:3px;">${t.reason} • ${t.closeTime.toLocaleTimeString()}</div></div>`;}).join('');document.getElementById('tradeLog').innerHTML=html;}
function initChart(){const ctx=document.getElementById('predictionChart').getContext('2d');chart=new Chart(ctx,{type:'line',data:{labels:chartData.labels,datasets:[{label:'Actual',data:chartData.actual,borderColor:'#f59e0b',backgroundColor:'rgba(245,158,11,0.05)',borderWidth:2,tension:0.4,pointRadius:3},{label:'Predicted',data:chartData.predicted,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.05)',borderWidth:2,borderDash:[5,5],tension:0.4,pointRadius:3}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#94a3b8',font:{size:11,weight:600}}}},scales:{x:{ticks:{color:'#64748b'}},y:{ticks:{color:'#64748b',callback:v=>'$'+v.toLocaleString('en-US')}}}}});}function updateChart(actual,predicted){const time=new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});chartData.labels.push(time);chartData.actual.push(actual);chartData.predicted.push(predicted||actual);if(chartData.labels.length>20){chartData.labels.shift();chartData.actual.shift();chartData.predicted.shift();}if(chart)chart.update('none');}function calculateBollingerBands(p,period=20){if(p.length<period)return{upper:p[p.length-1],middle:p[p.length-1],lower:p[p.length-1]};const recent=p.slice(-period);const sma=recent.reduce((a,b)=>a+b)/period;const variance=recent.reduce((sum,price)=>sum+Math.pow(price-sma,2),0)/period;const std=Math.sqrt(variance);return{upper:sma+(std*2),middle:sma,lower:sma-(std*2)};}function calculateADX(p,period=14){if(p.length<period+1)return 25;let plusDM=0,minusDM=0,tr=0;for(let i=p.length-period;i<p.length;i++){const trueRange=Math.max(p[i]-p[i],Math.abs(p[i]-p[i-1]),Math.abs(p[i]-p[i-1]));tr+=trueRange;const upMove=p[i]-p[i-1];const downMove=p[i-1]-p[i];if(upMove>downMove&&upMove>0)plusDM+=upMove;if(downMove>upMove&&downMove>0)minusDM+=downMove;}const plusDI=(plusDM/tr)*100;const minusDI=(minusDM/tr)*100;const dx=Math.abs(plusDI-minusDI)/(plusDI+minusDI)*100;return dx||25;}function calculateConfidence(ind,regime){if(!ind)return 30;const rsi=ind.rsi;const vol=ind.volatility;const adx=ind.adx||25;const curr=history[history.length-1];const bb=ind.bb;let confidence=40;if(adx>25)confidence+=15;else confidence-=10;if(curr>bb.upper||curr<bb.lower)confidence+=10;if(rsi>70||rsi<30)confidence+=15;else if(rsi>45&&rsi<55)confidence-=15;if(vol<0.3)confidence-=20;if(vol>1.0)confidence+=10;if(regime==='trending'){if(Math.abs(ind.trend)>0.5)confidence+=10;}else{if(vol<0.5)confidence-=15;}return Math.min(85,Math.max(25,confidence));}function updateStreak(correct){if(currentStreak.type===null){currentStreak.type=correct?'win':'loss';currentStreak.count=1;}else if((correct&&currentStreak.type==='win')||(!correct&&currentStreak.type==='loss')){currentStreak.count++;}else{currentStreak.type=correct?'win':'loss';currentStreak.count=1;}}function exportData(){const correct=evaluatedPredictions.filter(p=>p.correct).length;const total=evaluatedPredictions.length;const data={metadata:{version:"15.0",exportDate:new Date().toISOString()},history,predictions,evaluatedPredictions,modelWeights,chartData,currentStreak,trades,trading:{currentBalance,winCount,liqCount,startingBalance,leverage},performance:{total,correct,accuracy:total>0?(correct/total*100).toFixed(2)+'%':'0%'}};const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`btc-v15-${Date.now()}.json`;a.click();URL.revokeObjectURL(url);}function importData(content){try{const data=JSON.parse(content);if(data.metadata){history=data.history||[];predictions=data.predictions||[];evaluatedPredictions=data.evaluatedPredictions||[];modelWeights=data.modelWeights||modelWeights;chartData=data.chartData||chartData;currentStreak=data.currentStreak||{type:null,count:0};if(data.trading){currentBalance=data.trading.currentBalance||1000;winCount=data.trading.winCount||0;liqCount=data.trading.liqCount||0;trades=data.trades||[];}if(chart)chart.update();}}catch(e){}}function saveLocal(){try{localStorage.setItem('btc-v15',JSON.stringify({history:history.slice(-100),evaluatedPredictions,modelWeights,chartData,currentStreak,trades,trading:{currentBalance,winCount,liqCount},lastSave:Date.now()}));}catch(e){}}function loadLocal(){try{const saved=localStorage.getItem('btc-v15');if(saved){const data=JSON.parse(saved);history=data.history||[];evaluatedPredictions=data.evaluatedPredictions||[];modelWeights=data.modelWeights||modelWeights;chartData=data.chartData||chartData;currentStreak=data.currentStreak||{type:null,count:0};trades=data.trades||[];if(data.trading){currentBalance=data.trading.currentBalance||1000;winCount=data.trading.winCount||0;liqCount=data.trading.liqCount||0;}return true;}}catch(e){}return false;}function resetAll(){if(confirm('⚠️ Delete all?')){history=[];predictions=[];evaluatedPredictions=[];chartData={labels:[],actual:[],predicted:[]};modelWeights={trend:9,momentum:9,rsi:9,macd:9,ema:9,volatility:9,volume:9,stochastic:9,bb:9,adx:9,atr:9};currentStreak={type:null,count:0};trades=[];winCount=0;liqCount=0;currentBalance=startingBalance;localStorage.removeItem('btc-v15');setTimeout(()=>location.reload(),500);}}async function fetchBTCPrice(){const r=await fetch(`${PYTH_API_URL}?ids[]=${PYTH_BTC_ID}`);const d=await r.json();if(d&&d[0]&&d[0].price){const p=d[0].price;return{price:parseFloat(p.price)*Math.pow(10,p.expo),timestamp:Date.now()};}throw new Error('Invalid');}function calculateRSI(p,period=14){if(p.length<period+1)return 50;let gains=0,losses=0;for(let i=p.length-period;i<p.length;i++){const c=p[i]-p[i-1];if(c>0)gains+=c;else losses+=Math.abs(c);}const rs=(gains/period)/(losses/period||1);return 100-(100/(1+rs));}function calculateEMA(p,period){if(p.length<period)return p[p.length-1];const k=2/(period+1);let ema=p.slice(0,period).reduce((a,b)=>a+b)/period;for(let i=period;i<p.length;i++)ema=p[i]*k+ema*(1-k);return ema;}function calculateMACD(p){return calculateEMA(p,12)-calculateEMA(p,26);}function calculateStochastic(p,period=14){if(p.length<period)return 50;const recent=p.slice(-period);const high=Math.max(...recent),low=Math.min(...recent),current=p[p.length-1];return((current-low)/(high-low||1))*100;}function calculateVolatility(p,period=20){if(p.length<period)return 0;const recent=p.slice(-period);const avg=recent.reduce((a,b)=>a+b)/period;const variance=recent.reduce((s,price)=>s+Math.pow(price-avg,2),0)/period;return Math.sqrt(variance)/avg*100;}function detectRegime(p){if(p.length<20)return'ranging';const adx=calculateADX(p);const vol=calculateVolatility(p);if(adx>25&&vol>0.5)return'trending';return'ranging';}function calculateIndicators(p){if(p.length<MIN_DATA_POINTS)return null;const curr=p[p.length-1],prev=p[p.length-2];const bb=calculateBollingerBands(p);return{trend:((curr-prev)/prev)*100,momentum:p.length>=5?((curr-p[p.length-5])/p[p.length-5])*100:0,rsi:calculateRSI(p),macd:calculateMACD(p),ema:calculateEMA(p,20),volatility:calculateVolatility(p),volume:Math.random()*10,stochastic:calculateStochastic(p),bb:bb,bbPosition:(curr-bb.lower)/(bb.upper-bb.lower)*100,adx:calculateADX(p),atr:0};}function makePrediction(curr,ind,regime){if(!ind)return null;const sig={trend:ind.trend,momentum:ind.momentum*0.8,rsi:(ind.rsi-50)/50,macd:Math.tanh(ind.macd/100),ema:((curr-ind.ema)/ind.ema)*100,volatility:Math.min(ind.volatility/2,1),volume:(ind.volume-5)/5,stochastic:(ind.stochastic-50)/50,bb:(ind.bbPosition-50)/50,adx:(ind.adx-25)/25,atr:0};const mult=regime==='trending'?{trend:3.5,momentum:3,rsi:1.2,macd:2,ema:1.8,volatility:0.8,volume:1,stochastic:0.8,bb:2,adx:3,atr:1.5}:{trend:1.5,momentum:1.5,rsi:3.5,macd:1.5,ema:2,volatility:0.5,volume:0.8,stochastic:3,bb:3.5,adx:1,atr:1};let wSig=0,tWeight=0;for(const[k,s]of Object.entries(sig)){const w=modelWeights[k]*mult[k];wSig+=s*w;tWeight+=w;}const norm=wSig/tWeight;const maxChange=regime==='trending'?1.5:0.5;let pred=curr*(1+(norm*maxChange)/100);if(predictions.length>0){const last=predictions[predictions.length-1].price;pred=pred*(1-STABILITY_FACTOR)+last*STABILITY_FACTOR;}const confidence=calculateConfidence(ind,regime);return{price:pred,change:((pred-curr)/curr)*100,direction:pred>curr?'UP ⬆️':'DOWN ⬇️',regime,timestamp:Date.now(),targetTime:Date.now()+(PREDICTION_WINDOW*60*1000),confidence};}function evaluatePredictions(curr){const now=Date.now(),windowMs=PREDICTION_WINDOW*60*1000;predictions=predictions.filter(pred=>{if(now-pred.timestamp>=windowMs){const actDir=curr>pred.currentPrice?'up':'down';const predDir=pred.price>pred.currentPrice?'up':'down';const correct=actDir===predDir;evaluatedPredictions.push({correct,regime:pred.regime,timestamp:pred.timestamp});if(evaluatedPredictions.length>50)evaluatedPredictions.shift();updateStreak(correct);if(soundEnabled&&correct)playSound();const learningFactor=pred.confidence>60?LEARNING_RATE:LEARNING_RATE*0.5;if(correct){if(pred.regime==='trending'){modelWeights.trend*=(1+learningFactor*0.4);modelWeights.momentum*=(1+learningFactor*0.4);modelWeights.adx*=(1+learningFactor*0.3);}else{modelWeights.rsi*=(1+learningFactor*0.4);modelWeights.bb*=(1+learningFactor*0.4);modelWeights.stochastic*=(1+learningFactor*0.3);}}else{if(pred.regime==='trending'){modelWeights.trend*=(1-learningFactor*0.3);modelWeights.momentum*=(1-learningFactor*0.3);}else{modelWeights.rsi*=(1-learningFactor*0.3);modelWeights.bb*=(1-learningFactor*0.3);}}let total=Object.values(modelWeights).reduce((a,b)=>a+b);for(const k in modelWeights){modelWeights[k]=(modelWeights[k]/total)*100;modelWeights[k]=Math.max(5,Math.min(15,modelWeights[k]));}return false;}return true;});}function updateUI(priceData,prediction){const price=priceData.price;if(firstPrice===0)firstPrice=price;if(lastPriceForChange===0)lastPriceForChange=price;const priceChangePercent=((price-lastPriceForChange)/lastPriceForChange)*100;const priceChangeEl=document.getElementById('priceChange');priceChangeEl.textContent=`${priceChangePercent>=0?'+':''}${priceChangePercent.toFixed(2)}%`;priceChangeEl.className=`price-change ${priceChangePercent>=0?'positive':'negative'}`;document.getElementById('currentPrice').textContent=`$${price.toLocaleString('en-US',{minimumFractionDigits:2})}`;document.getElementById('lastUpdate').textContent=`Updated: ${new Date().toLocaleTimeString()}`;document.getElementById('dataPoints').textContent=history.length;updateChart(price,prediction?prediction.price:null);if(prediction){document.getElementById('predictedPrice').textContent=`$${prediction.price.toLocaleString('en-US',{minimumFractionDigits:2})}`;document.getElementById('predictionTime').textContent=`For ${new Date(prediction.targetTime).toLocaleTimeString()}`;document.getElementById('direction').textContent=prediction.direction;document.getElementById('direction').style.color=prediction.change>0?'#10b981':'#ef4444';const confPercent=prediction.confidence;document.getElementById('confidenceFill').style.width=confPercent+'%';document.getElementById('confidenceText').textContent=`Confidence: ${confPercent.toFixed(0)}%`;const regimeEl=document.getElementById('regime');regimeEl.textContent=prediction.regime.toUpperCase();regimeEl.style.background=prediction.regime==='trending'?'rgba(16,185,129,0.2)':'rgba(245,158,11,0.2)';regimeEl.style.color=prediction.regime==='trending'?'#10b981':'#f59e0b';if(isTrading&&currentBalance>0){if(!position){const type=prediction.direction.includes('UP')?'long':'short';openPosition(type,price);}else{const shouldClose=(position.type==='long'&&prediction.direction.includes('DOWN'))||(position.type==='short'&&prediction.direction.includes('UP'));if(shouldClose){closePosition('Signal Change',price);const newType=prediction.direction.includes('UP')?'long':'short';if(currentBalance>0)openPosition(newType,price);}}}}if(currentStreak.count>0){const streakEl=document.getElementById('streakBadge');streakEl.className=`streak-badge ${currentStreak.type==='win'?'streak-win':'streak-loss'}`;streakEl.textContent=`${currentStreak.count} ${currentStreak.type==='win'?'🔥 Win':'❄️ Loss'} Streak`;}const correct=evaluatedPredictions.filter(p=>p.correct).length;const total=evaluatedPredictions.length;const accuracy=total>0?(correct/total*100):0;document.getElementById('accuracy').textContent=accuracy.toFixed(1)+'%';document.getElementById('totalPredictions').textContent=total;document.getElementById('winRate').textContent=accuracy.toFixed(1)+'%';const weightsHTML=Object.entries(modelWeights).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<div class="weight-bar"><div class="weight-label"><span>${k.toUpperCase()}</span><span>${v.toFixed(1)}%</span></div><div class="weight-progress"><div class="weight-fill" style="width:${v}%"></div></div></div>`).join('');document.getElementById('weightsDisplay').innerHTML=weightsHTML;if(evaluatedPredictions.length>0){const logHTML=evaluatedPredictions.slice(-10).reverse().map(p=>`<div class="log-entry ${p.correct?'correct':'incorrect'}">${p.correct?'✅':'❌'} ${p.regime.toUpperCase()} - ${new Date(p.timestamp).toLocaleTimeString()}</div>`).join('');document.getElementById('logEntries').innerHTML=logHTML;}if(isTrading&&position){checkLiquidation(price);updateTradingUI();}lastPriceForChange=price;}async function update(){try{const priceData=await fetchBTCPrice();if(priceData&&priceData.price){const price=priceData.price;history.push(price);if(history.length>100)history.shift();evaluatePredictions(price);const regime=detectRegime(history);const indicators=calculateIndicators(history);const prediction=indicators?makePrediction(price,indicators,regime):null;if(prediction)predictions.push({...prediction,currentPrice:price});updateUI(priceData,prediction);document.getElementById('loading').style.display='none';document.getElementById('content').style.display='block';}}catch(error){console.error('Error:',error);}}document.getElementById('exportBtn').addEventListener('click',exportData);document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('importFile').click());document.getElementById('importFile').addEventListener('change',(e)=>{const file=e.target.files[0];if(file){const reader=new FileReader();reader.onload=(e)=>importData(e.target.result);reader.readAsText(file);}});document.getElementById('resetBtn').addEventListener('click',resetAll);loadLocal();setTimeout(()=>{if(document.getElementById('content').style.display!=='none')initChart();},100);update();setInterval(update,UPDATE_INTERVAL);setInterval(saveLocal,300000);
    </script>
</body>
</html>

</body>
</html>

</body>
</html>
