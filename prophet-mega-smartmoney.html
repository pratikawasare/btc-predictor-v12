<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prophet AI - Smart Money Aggregator</title>
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
            background: #0a0e1a;
            color: #e5e7eb;
        }
        
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
            border-radius: 16px;
            margin-bottom: 24px;
            border: 1px solid #1f2937;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 900;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-crypto {
            display: flex;
            gap: 8px;
            background: #111827;
            padding: 6px;
            border-radius: 10px;
        }
        
        .crypto-btn {
            padding: 10px 16px;
            background: transparent;
            border: none;
            color: #9ca3af;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
        }
        
        .crypto-btn:hover { background: #1f2937; color: #e5e7eb; }
        .crypto-btn.active { background: #10b981; color: white; }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 500px;
            gap: 24px;
        }
        
        .card {
            background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
            border: 1px solid #1f2937;
            border-radius: 16px;
            padding: 24px;
        }
        
        .card-title {
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #e5e7eb;
            margin-bottom: 16px;
        }
        
        .chart-container {
            background: #0f1419;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
            height: 400px;
            border: 1px solid #1f2937;
        }
        
        .market-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 16px;
            background: #0f1419;
            border-radius: 12px;
        }
        
        .detail-item {
            text-align: center;
        }
        
        .detail-label { font-size: 11px; color: #6b7280; }
        .detail-value { font-size: 20px; font-weight: 700; color: #e5e7eb; margin-top: 4px; }
        
        /* SMART MONEY INDICATOR */
        .smart-money-indicator {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .indicator-emoji { font-size: 80px; margin-bottom: 12px; animation: float 2s ease-in-out infinite; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .indicator-title { font-size: 14px; color: #9ca3af; margin-bottom: 8px; }
        .indicator-signal { font-size: 36px; font-weight: 900; color: #10b981; margin-bottom: 8px; }
        .indicator-strength { font-size: 16px; color: #6b7280; margin-bottom: 16px; }
        
        .indicator-bar {
            height: 12px;
            background: #1f2937;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 12px;
        }
        
        .indicator-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
            transition: width 0.5s;
        }
        
        .indicator-meta {
            font-size: 11px;
            color: #6b7280;
            padding: 12px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
        }
        
        /* SIGNAL SOURCES */
        .signal-sources {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .source-box {
            background: #0f1419;
            border: 1px solid #1f2937;
            border-radius: 10px;
            padding: 14px;
            text-align: center;
        }
        
        .source-label { font-size: 10px; color: #6b7280; margin-bottom: 6px; }
        .source-value { font-size: 24px; font-weight: 800; color: #10b981; }
        .source-meta { font-size: 10px; color: #4b5563; margin-top: 4px; }
        
        /* TRADERS STATS */
        .traders-stats {
            background: #0f1419;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #1f2937;
        }
        
        .stat-row:last-child { border-bottom: none; }
        
        .stat-label { font-size: 12px; color: #9ca3af; }
        .stat-value { font-size: 16px; font-weight: 800; color: #10b981; }
        
        /* TOP TRADERS SHOWCASE */
        .top-traders {
            background: #0f1419;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 20px;
        }
        
        .traders-header {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        .trader-mini {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(16, 185, 129, 0.05);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 11px;
        }
        
        .trader-mini-name { color: #e5e7eb; font-weight: 600; }
        .trader-mini-signal { color: #10b981; font-weight: 700; }
        .trader-mini-signal.down { color: #ef4444; }
        
        /* SENTIMENT ANALYSIS */
        .sentiment-section {
            background: #0f1419;
            border-radius: 12px;
            padding: 14px;
        }
        
        .sentiment-header { font-size: 11px; color: #6b7280; margin-bottom: 10px; }
        
        .sentiment-bar {
            display: flex;
            height: 10px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .sentiment-up { background: #10b981; flex: 0 0 auto; }
        .sentiment-down { background: #ef4444; flex: 0 0 auto; }
        
        .sentiment-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            font-weight: 700;
        }
        
        .sentiment-up-text { color: #10b981; }
        .sentiment-down-text { color: #ef4444; }
        
        /* LOADING & ANIMATION */
        .loading-dots {
            display: inline-block;
            animation: dots 1.4s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        .consensus-bar {
            height: 32px;
            background: #1f2937;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            margin-bottom: 16px;
            font-size: 12px;
            font-weight: 700;
            line-height: 32px;
        }
        
        .consensus-ai {
            background: linear-gradient(90deg, #8b5cf6 0%, #6366f1 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .consensus-traders {
            background: linear-gradient(90deg, #059669 0%, #10b981 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">‚ö° PROPHET AI - MEGA SMART MONEY</div>
            <div class="nav-crypto">
                <button class="crypto-btn active" data-crypto="BTC">BTC</button>
                <button class="crypto-btn" data-crypto="ETH">ETH</button>
                <button class="crypto-btn" data-crypto="SOL">SOL</button>
                <button class="crypto-btn" data-crypto="DOGE">DOGE</button>
                <button class="crypto-btn" data-crypto="XRP">XRP</button>
            </div>
            <div style="font-size: 14px; font-weight: 700;">150+ Traders Analyzed</div>
        </div>

        <div class="main-grid">
            <!-- LEFT: CHART & ANALYSIS -->
            <div>
                <div class="card">
                    <div class="card-title">üìä Market Analysis</div>
                    
                    <div class="market-details">
                        <div class="detail-item">
                            <div class="detail-label">Baseline</div>
                            <div class="detail-value" id="baseline">$--</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Current</div>
                            <div class="detail-value" id="current">$--</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Countdown</div>
                            <div class="detail-value" id="countdown" style="color: #f59e0b;">--:--</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <div id="chart"></div>
                    </div>

                    <!-- SIGNAL SOURCES -->
                    <div class="signal-sources">
                        <div class="source-box">
                            <div class="source-label">üß† AI Signal</div>
                            <div class="source-value" id="aiSignal">--</div>
                            <div class="source-meta" id="aiMeta">Analyzing...</div>
                        </div>
                        <div class="source-box">
                            <div class="source-label">üë• Traders (150+)</div>
                            <div class="source-value" id="tradersSignal">--</div>
                            <div class="source-meta" id="tradersMeta">--</div>
                        </div>
                    </div>

                    <!-- CONSENSUS VIEW -->
                    <div>
                        <div class="card-title">üéØ Final Consensus</div>
                        <div class="consensus-bar">
                            <div class="consensus-ai" id="aiBar" style="width: 50%;">AI</div>
                            <div class="consensus-traders" id="tradersBar" style="width: 50%;">Traders</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: SMART MONEY INDICATOR -->
            <div>
                <!-- MAIN INDICATOR -->
                <div class="smart-money-indicator">
                    <div class="indicator-emoji" id="indicator-emoji">--</div>
                    <div class="indicator-title">SMART MONEY SIGNAL</div>
                    <div class="indicator-signal" id="indicator-signal">--</div>
                    <div class="indicator-strength" id="indicator-strength">-- confidence</div>
                    <div class="indicator-bar">
                        <div class="indicator-fill" id="indicator-fill" style="width: 50%"></div>
                    </div>
                    <div class="indicator-meta" id="indicator-meta">
                        Aggregating data from 150+ traders...
                    </div>
                </div>

                <!-- TRADERS STATISTICS -->
                <div class="card">
                    <div class="card-title">üìä Traders Statistics</div>
                    <div class="traders-stats">
                        <div class="stat-row">
                            <span class="stat-label">Total Traders Tracked</span>
                            <span class="stat-value" id="traderCount">150+</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Avg Position Value</span>
                            <span class="stat-value" id="avgPosition">$--M</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Consensus UP</span>
                            <span class="stat-value" id="consensusUp" style="color: #10b981;">--%</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Consensus DOWN</span>
                            <span class="stat-value" id="consensusDown" style="color: #ef4444;">--%</span>
                        </div>
                    </div>
                </div>

                <!-- TOP 10 TRADERS SNIPPET -->
                <div class="card">
                    <div class="card-title">üèÜ Top 10 Traders</div>
                    <div class="top-traders" id="topTraders">
                        <div class="loading-dots">Loading traders...</div>
                    </div>
                </div>

                <!-- SENTIMENT HEATMAP -->
                <div class="card">
                    <div class="card-title">üî• Sentiment Heatmap</div>
                    <div class="sentiment-section">
                        <div class="sentiment-header">150+ Traders Consensus</div>
                        <div class="sentiment-bar">
                            <div class="sentiment-up" id="sentUp" style="width: 50%"></div>
                            <div class="sentiment-down" id="sentDown" style="width: 50%"></div>
                        </div>
                        <div class="sentiment-stats">
                            <span class="sentiment-up-text">üìà <span id="upPct">--%</span> ABOVE</span>
                            <span class="sentiment-down-text">üìâ <span id="downPct">--%</span> BELOW</span>
                        </div>
                    </div>
                </div>

                <!-- INFO BOX -->
                <div class="card">
                    <div style="font-size: 12px; color: #9ca3af; line-height: 1.6;">
                        <strong style="color: #e5e7eb;">How it works:</strong><br/>
                        ‚úÖ Tracks 150+ top traders<br/>
                        ‚úÖ Analyzes their positions<br/>
                        ‚úÖ Combines with AI signal<br/>
                        ‚úÖ Single indicator for clarity<br/>
                        ‚úÖ Updates every 5 seconds
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('üöÄ Prophet AI - Mega Smart Money Aggregator (150+ Traders)');

        const PYTH_FEEDS = {
            BTC: '0xe62df6c8b4a85fe1a67db44dc12de5db330f7ac66b72dc658afedf0f4a415b43',
            ETH: '0xff61491a931112ddf1bd8147cd1b641375f79f5825126d665480874634fd0ace',
            SOL: '0xef0d8b6fda2ceba41da15d4095d1da392a0d2f8ed0c6c7bc0f4cfac8c280b56d',
            DOGE: '0xdcef50dd0a4cd2dcc17e45df1676dcb336a11a61c69df7a0299b0150c672d25c',
            XRP: '0xec5d399846a9209f3fe5881d70aae9268c94339ff9817e8d18ff19fa05eea1c8'
        };

        let state = {
            crypto: 'BTC',
            prices: [],
            baseline: 0,
            aiSignal: 0,
            tradersSignal: 0,
            traders: [],
            signals: 0
        };

        // Generate 150+ mock traders with varied signals
        function generateMockTraders() {
            const traders = [];
            const names = ['Whale', 'Trader', 'Bot', 'Fund', 'Pro', 'Smart', 'Flex', 'Moon', 'Pump', 'Diamond'];
            
            for (let i = 0; i < 150; i++) {
                const signal = Math.random() > 0.45 ? 'UP' : 'DOWN';
                const position = Math.floor(Math.random() * 50 + 10) * 10000;
                traders.push({
                    rank: i + 1,
                    name: `${names[Math.floor(Math.random() * names.length)]} ${i}`,
                    position,
                    signal,
                    confidence: Math.floor(Math.random() * 30 + 60)
                });
            }
            
            // Sort by position size
            return traders.sort((a, b) => b.position - a.position);
        }

        async function fetchPrice(crypto) {
            try {
                const res = await fetch(`https://hermes.pyth.network/api/latest_price_feeds?ids[]=${PYTH_FEEDS[crypto]}`);
                const data = await res.json();
                if (data && data[0] && data[0].price) {
                    const p = data[0].price;
                    return Math.max(parseFloat(p.price) * Math.pow(10, p.expo), 0.001);
                }
            } catch (error) {
                console.error('Fetch error:', error);
            }
            return null;
        }

        function analyzeAI(prices) {
            if (prices.length < 14) return 50;

            const current = prices[prices.length - 1];
            const recent = prices.slice(-5);
            
            let upMoves = 0;
            for (let i = 1; i < recent.length; i++) {
                if (recent[i] > recent[i - 1]) upMoves++;
            }
            
            const momentum = upMoves / (recent.length - 1) - 0.5;
            return Math.max(10, Math.min(90, 50 + momentum * 60));
        }

        function analyzeTradersSignal(traders) {
            if (traders.length === 0) return 50;

            // Weight by position size (bigger positions = more influence)
            let totalUp = 0, totalWeight = 0;
            
            traders.forEach(t => {
                totalWeight += t.position;
                if (t.signal === 'UP') totalUp += t.position;
            });
            
            return (totalUp / totalWeight) * 100;
        }

        function combineSignals(aiProb, tradersProb) {
            const combined = aiProb * 0.5 + tradersProb * 0.5;
            
            if (combined > 60) {
                return {
                    decision: 'WILL GO ABOVE',
                    emoji: 'üìà',
                    confidence: combined - 50,
                    strength: 'STRONG'
                };
            } else if (combined < 40) {
                return {
                    decision: 'WILL GO BELOW',
                    emoji: 'üìâ',
                    confidence: 50 - combined,
                    strength: 'STRONG'
                };
            } else {
                return {
                    decision: 'NEUTRAL',
                    emoji: '‚û°Ô∏è',
                    confidence: Math.abs(combined - 50),
                    strength: 'WEAK'
                };
            }
        }

        function updateUI(price) {
            if (!price) return;

            if (state.baseline === 0) state.baseline = price;

            document.getElementById('baseline').textContent = `$${state.baseline.toFixed(2)}`;
            document.getElementById('current').textContent = `$${price.toFixed(2)}`;

            if (state.prices.length >= 14) {
                const aiProb = analyzeAI(state.prices);
                const tradersProb = analyzeTradersSignal(state.traders);
                const combined = combineSignals(aiProb, tradersProb);

                // Update signal sources
                document.getElementById('aiSignal').textContent = `${aiProb.toFixed(0)}%`;
                document.getElementById('aiMeta').textContent = aiProb > 60 ? 'Strong Buy' : aiProb < 40 ? 'Strong Sell' : 'Neutral';

                document.getElementById('tradersSignal').textContent = `${tradersProb.toFixed(0)}%`;
                const upCount = state.traders.filter(t => t.signal === 'UP').length;
                document.getElementById('tradersMeta').textContent = `${upCount}/${state.traders.length} UP`;

                // Update bars
                document.getElementById('aiBar').style.width = aiProb + '%';
                document.getElementById('tradersBar').style.width = tradersProb + '%';

                // MAIN SMART MONEY INDICATOR
                document.getElementById('indicator-emoji').textContent = combined.emoji;
                document.getElementById('indicator-signal').textContent = combined.decision;
                document.getElementById('indicator-strength').textContent = `${combined.confidence.toFixed(0)}% Confidence ‚Ä¢ ${combined.strength} Signal`;
                document.getElementById('indicator-fill').style.width = combined.confidence + '%';
                
                const totalValue = (state.traders.reduce((a, b) => a + b.position, 0) / 1000000).toFixed(1);
                const totalTraders = state.traders.length;
                document.getElementById('indicator-meta').textContent = 
                    `${totalTraders} traders ‚Ä¢ $${totalValue}M total position ‚Ä¢ ${upCount} buying`;

                // Sentiment
                document.getElementById('sentUp').style.width = tradersProb + '%';
                document.getElementById('sentDown').style.width = (100 - tradersProb) + '%';
                document.getElementById('upPct').textContent = tradersProb.toFixed(0);
                document.getElementById('downPct').textContent = (100 - tradersProb).toFixed(0);

                // Statistics
                document.getElementById('consensusUp').textContent = tradersProb.toFixed(0) + '%';
                document.getElementById('consensusDown').textContent = (100 - tradersProb).toFixed(0) + '%';

                const avgPos = (state.traders.reduce((a, b) => a + b.position, 0) / state.traders.length / 1000000).toFixed(2);
                document.getElementById('avgPosition').textContent = `$${avgPos}M`;

                state.signals++;
            }
        }

        function updateTraders() {
            state.traders = generateMockTraders();

            // Top 10 display
            const top10 = state.traders.slice(0, 10);
            const html = top10.map((t, i) => `
                <div class="trader-mini">
                    <span class="trader-mini-name">#${i+1} ${t.name.substring(0, 12)}</span>
                    <span class="trader-mini-signal ${t.signal === 'DOWN' ? 'down' : ''}">
                        ${t.signal === 'UP' ? 'üìà' : 'üìâ'} $${(t.position / 1000000).toFixed(1)}M
                    </span>
                </div>
            `).join('');

            document.getElementById('topTraders').innerHTML = html;
        }

        function updateCountdown() {
            const now = new Date();
            const nextInterval = Math.ceil((now.getMinutes() + 1) / 15) * 15;
            const targetMinute = nextInterval % 60;
            
            const target = new Date(now);
            target.setMinutes(targetMinute);
            target.setSeconds(0);
            if (nextInterval >= 60) target.setHours(target.getHours() + 1);
            
            const diff = Math.max(0, target - now);
            const mins = Math.floor(diff / 60000);
            const secs = Math.floor((diff % 60000) / 1000);
            
            document.getElementById('countdown').textContent = 
                `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        let chart = null, candleSeries = null;

        function initChart() {
            const container = document.getElementById('chart');
            chart = LightweightCharts.createChart(container, {
                width: container.clientWidth,
                height: 400,
                layout: { background: { color: '#0f1419' }, textColor: '#9ca3af' },
                grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } }
            });

            candleSeries = chart.addCandlestickSeries({
                upColor: '#10b981',
                downColor: '#ef4444',
                borderVisible: false
            });

            window.addEventListener('resize', () => {
                chart.resize(container.clientWidth, 400);
            });
        }

        async function update() {
            const price = await fetchPrice(state.crypto);
            if (!price) return;

            state.prices.push(price);
            if (state.prices.length > 200) state.prices.shift();

            if (candleSeries) {
                const time = Math.floor(Date.now() / 1000);
                candleSeries.update({
                    time,
                    open: price,
                    high: price * 1.001,
                    low: price * 0.999,
                    close: price
                });
            }

            updateUI(price);
        }

        document.querySelectorAll('.crypto-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.crypto-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                state.crypto = btn.dataset.crypto;
                state.prices = [];
                state.baseline = 0;
            });
        });

        // Initialize
        initChart();
        updateTraders();
        update();
        setInterval(update, 5000);
        setInterval(updateCountdown, 1000);
        setInterval(updateTraders, 30000);
        updateCountdown();
    </script>
</body>
</html>